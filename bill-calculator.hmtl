<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Utility Bill Calculator Pakistan 2025</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#333;margin:0;padding:20px;min-height:100vh}
    .container{max-width:800px;margin:30px auto;background:#fff;border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,0.2);overflow:hidden}
    .header{background:#2c3e50;color:#fff;padding:30px;text-align:center}
    h1{margin:0;font-size:2.4rem}
    .subtitle{font-size:1.1rem;opacity:0.9;margin-top:8px}
    .card{padding:35px}
    select,input{width:100%;padding:16px;margin:12px 0;border:2px solid #ddd;border-radius:12px;font-size:1.1rem;box-sizing:border-box}
    select:focus,input:focus{border-color:#667eea;outline:none}
    button{background:#e74c3c;color:#fff;padding:18px 40px;border:none;border-radius:12px;cursor:pointer;font-size:1.3rem;font-weight:bold;margin-top:20px;width:100%}
    button:hover{background:#c0392b}
    .result{margin-top:40px;background:#f8f9fa;padding:30px;border-radius:16px;display:none}
    table{width:100%;border-collapse:collapse;margin:20px 0}
    th,td{padding:14px;text-align:left;border-bottom:1px solid #ddd}
    th{background:#667eea;color:#fff}
    .total{font-size:1.5rem;font-weight:bold;color:#e74c3c;padding:20px;background:#fff3cd;border-radius:12px;text-align:center;margin:20px 0}
    .note{font-size:0.95rem;color:#e74c3c;margin-top:20px;text-align:center}
    footer{padding:20px;background:#2c3e50;color:#fff;text-align:center;font-size:0.9rem}
    .tou-input{display:none}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Utility Bill Calculator</h1>
    <p class="subtitle">Electricity + Gas + Water • Pakistan 2025 (NEPRA/OGRA/PWRA Tariffs)</p>
  </div>

  <div class="card">
    <form id="billForm">
      <select id="utility" required>
        <option value="">Select Utility</option>
        <option value="electricity">Electricity</option>
        <option value="gas">Gas</option>
        <option value="water">Water</option>
      </select>

      <select id="company" required>
        <option value="">Select Company</option>
        <!-- Electricity Companies -->
        <option data-utility="electricity" value="ke">K-Electric (Karachi)</option>
        <option data-utility="electricity" value="lesco">LESCO (Lahore)</option>
        <option data-utility="electricity" value="iesco">IESCO (Islamabad)</option>
        <option data-utility="electricity" value="fesco">FESCO (Faisalabad)</option>
        <option data-utility="electricity" value="mepco">MEPCO (Multan)</option>
        <option data-utility="electricity" value="gepco">GEPCO (Gujranwala)</option>
        <option data-utility="electricity" value="pesco">PESCO (Peshawar)</option>
        <option data-utility="electricity" value="hesco">HESCO (Hyderabad)</option>
        <option data-utility="electricity" value="qesco">QESCO (Quetta)</option>
        <option data-utility="electricity" value="tesco">TESCO (Tribal)</option>
        <option data-utility="electricity" value="sepco">SEPCO (Sukkur)</option>
        <!-- Gas Companies -->
        <option data-utility="gas" value="sngpl">SNGPL (Punjab/KPK)</option>
        <option data-utility="gas" value="ssgc">SSGC (Sindh/Balochistan)</option>
        <!-- Water Companies -->
        <option data-utility="water" value="wasa_lahore">WASA Lahore</option>
        <option data-utility="water" value="wasa_faisalabad">WASA Faisalabad</option>
        <option data-utility="water" value="kwsb">KWSB Karachi</option>
        <option data-utility="water" value="qwasa">QWASA Quetta</option>
      </select>

      <select id="connection" required>
        <option value="">Connection Type</option>
        <option value="domestic">Domestic (Residential)</option>
        <option value="commercial">Commercial</option>
      </select>

      <select id="tariff" required>
        <option value="">Tariff Type</option>
        <option value="normal">Normal</option>
        <option value="protected">Protected (Low Usage)</option>
        <option value="tou">Time of Use (ToU)</option>
      </select>

      <div id="normalUnits">
        <input type="number" id="units" placeholder="Enter Units Consumed (MCF for Gas, KL for Water)" min="1">
      </div>

      <div id="touInput" class="tou-input">
        <input type="number" id="peak" placeholder="Peak Units" min="0">
        <input type="number" id="offpeak" placeholder="Off-Peak Units" min="0">
      </div>

      <button type="submit">Calculate Bill</button>
    </form>
  </div>

  <div id="result" class="result">
    <h2>Bill Breakdown</h2>
    <table>
      <thead>
        <tr><th>Description</th><th>Rate (Rs.)</th><th>Units</th><th>Amount (Rs.)</th></tr>
      </thead>
      <tbody id="breakdown"></tbody>
    </table>
    <div class="total" id="finalAmount"></div>
    <button onclick="window.print()" style="background:#27ae60;margin-top:20px">Print / Save as PDF</button>
    <p class="note">Estimated bill based on Nov–Dec 2025 tariffs. Actual may vary due to meter reading, arrears, or adjustments.</p>
  </div>

  <footer>Pakistan Utility Portal © 2025 – Accurate per NEPRA/OGRA/PWRA</footer>
</div>

<script>
// 2025 Tariffs (Nov-Dec) - Electricity (NEPRA Uniform)
const electricityTariff = {
  ke: {  // K-Electric
    protected: [[0,50,6.05],[50,100,11.10],[100,200,14.16],[200,Infinity,41.97]],
    normal: [[0,100,23.17],[100,200,28.07],[200,300,33.14],[300,Infinity,41.97]],
    tou_peak: 44.57, tou_offpeak: 34.57
  },
  lesco: {  // LESCO
    protected: [[0,50,6.05],[50,100,11.10],[100,200,14.16],[200,Infinity,41.97]],
    normal: [[0,100,23.17],[100,200,28.07],[200,300,33.14],[300,Infinity,41.97]],
    tou_peak: 44.57, tou_offpeak: 34.57
  },
  iesco: {  // IESCO
    protected: [[0,50,6.05],[50,100,11.10],[100,200,14.16],[200,Infinity,41.97]],
    normal: [[0,100,23.17],[100,200,28.07],[200,300,33.14],[300,Infinity,41.97]],
    tou_peak: 44.57, tou_offpeak: 34.57
  },
  // Similar for other DISCOs (fesco, mepco, gepco, pesco, hesco, qesco, sepco, tesco) - same uniform tariff
  fesco: electricityTariff.lesco, mepco: electricityTariff.lesco, gepco: electricityTariff.lesco, pesco: electricityTariff.lesco, hesco: electricityTariff.lesco, qesco: electricityTariff.lesco, sepco: electricityTariff.lesco, tesco: electricityTariff.lesco
};

// Gas Tariffs 2025 (OGRA - SNGPL/SSGC)
const gasTariff = {
  sngpl: {
    protected: [[0,50,5457],[50,100,5457],[100,200,5457],[200,300,5457],[300,Infinity,5457]],
    normal: [[0,50,5457],[50,100,5457],[100,200,5457],[200,300,5457],[300,Infinity,5457]]
  },
  ssgc: gasTariff.sngpl  // Similar rates
};

// Water Tariffs 2025 (PWRA - WASA/KWSB)
const waterTariff = {
  wasa_lahore: {
    domestic: 10.5,  // Rs per KL
    commercial: 25.0
  },
  wasa_faisalabad: { domestic: 12.0, commercial: 28.0 },
  kwsb: { domestic: 15.0, commercial: 35.0 },  // Karachi volumetric + fixed Rs 100
  qwasa: { domestic: 11.0, commercial: 26.0 }
};

// Common Taxes (17% GST, 1.5% ED, etc.)
const taxes = { gst: 0.17, ed: 0.015, fc: 0.43, tv: 35 };

// Show/hide ToU inputs
document.getElementById("tariff").addEventListener("change", () => {
  const tariff = document.getElementById("tariff").value;
  document.getElementById("normalUnits").style.display = tariff === "tou" ? "none" : "block";
  document.getElementById("touInput").style.display = tariff === "tou" ? "block" : "none";
});

// Filter companies by utility
document.getElementById("utility").addEventListener("change", () => {
  const utility = document.getElementById("utility").value;
  const options = document.getElementById("company").options;
  for (let i = 1; i < options.length; i++) {
    options[i].style.display = options[i].dataset.utility === utility ? "block" : "none";
  }
  document.getElementById("company").value = "";
});

// Calculate Bill
document.getElementById("billForm").onsubmit = function(e) {
  e.preventDefault();

  const utility = document.getElementById("utility").value;
  const company = document.getElementById("company").value;
  const connection = document.getElementById("connection").value;
  const tariff = document.getElementById("tariff").value;
  let units = 0, peak = 0, offpeak = 0;

  if (tariff === "tou") {
    peak = parseFloat(document.getElementById("peak").value) || 0;
    offpeak = parseFloat(document.getElementById("offpeak").value) || 0;
    units = peak + offpeak;
  } else {
    units = parseFloat(document.getElementById("units").value) || 0;
  }

  if (units <= 0) return alert("Enter valid units");

  let energyCharges = 0, fixed = 0;

  if (utility === "electricity") {
    const rates = electricityTariff[company];
    if (tariff === "tou") {
      energyCharges = (peak * rates.tou_peak) + (offpeak * rates.tou_offpeak);
    } else {
      const slab = tariff === "protected" ? rates.protected : rates.normal;
      let remaining = units;
      slab.forEach(s => {
        if (remaining <= 0) return;
        const slabSize = s[1] - (s[0] || 0);
        const used = Math.min(remaining, slabSize);
        energyCharges += used * s[2];
        remaining -= used;
      });
      if (remaining > 0) energyCharges += remaining * slab[slab.length - 1][2];
    }
    fixed = 0;  // Domestic fixed ~0
  } else if (utility === "gas") {
    const rates = gasTariff[company];
    const slab = connection === "domestic" ? rates.protected : rates.normal;
    let remaining = units;
    slab.forEach(s => {
      if (remaining <= 0) return;
      const slabSize = s[1] - (s[0] || 0);
      const used = Math.min(remaining, slabSize);
      energyCharges += used * s[2];
      remaining -= used;
    });
    if (remaining > 0) energyCharges += remaining * slab[slab.length - 1][2];
    fixed = 100;  // Typical fixed for gas
  } else if (utility === "water") {
    const rates = waterTariff[company];
    energyCharges = units * rates[connection];
    fixed = connection === "domestic" ? 50 : 200;  // Fixed monthly
  }

  const ed = energyCharges * taxes.ed;
  const gst = (energyCharges + fixed + ed) * taxes.gst;
  const fc = utility === "electricity" ? units * taxes.fc : 0;
  const total = Math.round(energyCharges + fixed + ed + gst + fc + taxes.tv);

  // Breakdown Table
  const breakdown = [
    {desc: "Energy Charges", amt: energyCharges.toFixed(0)},
    {desc: "Fixed Charges", amt: fixed.toFixed(0)},
    {desc: "Electricity Duty (1.5%)", amt: ed.toFixed(0)},
    {desc: "GST (17%)", amt: gst.toFixed(0)},
    {desc: "FC Surcharge", amt: fc.toFixed(0)},
    {desc: "TV License Fee", amt: taxes.tv},
    {desc: "<strong>Total Bill</strong>", amt: `<strong>Rs. ${total.toLocaleString()}</strong>`}
  ];

  let html = "";
  breakdown.forEach(row => html += `<tr><td>${row.desc}</td><td style="text-align:right">Rs. ${row.amt}</td></tr>`);

  document.getElementById("breakdown").innerHTML = html;
  document.getElementById("finalAmount").innerHTML = `Your Estimated Bill: <strong>Rs. ${total.toLocaleString()}</strong>`;
  document.getElementById("result").style.display = "block";
  window.scrollTo(0, document.getElementById("result").offsetTop - 100);
};
</script>
</body>
</html>
